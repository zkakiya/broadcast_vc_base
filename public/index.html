<!doctype html>
<html lang="ja">

<head>
  <meta charset="utf-8" />
  <title>Broadcast VC — Unified View</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/latest.css">
  <link rel="stylesheet" href="/css/timeline.css">
  <style>
    header {
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 10px 14px;
      border-bottom: 1px solid #1b2330;
    }

    header h1 {
      font-size: 16px;
      margin: 0;
      font-weight: 600;
      opacity: .9;
    }

    header .spacer {
      flex: 1
    }

    main {
      padding: 12px;
      display: grid;
      gap: 16px;
    }

    .pfp {
      border-radius: 12px;
      width: 48px;
      height: 48px;
      object-fit: cover;
      box-shadow: 0 8px 24px rgba(0, 0, 0, .25)
    }

    #timeline {
      max-height: 65vh;
      overflow: auto;
    }

    .entry {
      display: flex;
      gap: 10px;
      margin: 8px 0;
    }

    .entry .bubble {
      background: #111725;
      border: 1px solid #283042;
      border-radius: 14px;
      padding: 10px 12px;
      box-shadow: var(--shadow);
      max-width: 100%;
    }

    .entry .name {
      font-weight: 700;
      margin-bottom: 4px;
    }
  </style>
  <script>window.VIEW_MODE = (new URLSearchParams(location.search).get('view') || 'both');</script>
  <script>
    // OBS用UIオフ: ?ui=off
    if (new URLSearchParams(location.search).get('ui') === 'off') {
      const style = document.createElement('style');
      style.textContent = `header{display:none!important;} main{padding:0!important}`;
      document.head.appendChild(style);
    }
  </script>
</head>

<body>
  <header>
    <h1>Broadcast VC — Unified</h1>
    <div class="spacer"></div>
    <label>
      View:
      <select id="viewSel">
        <option value="both">both (avatars + latest)</option>
        <option value="latest">latest only</option>
        <option value="avatars">avatars only</option>
        <option value="timeline">timeline</option>
      </select>
    </label>
    <label style="margin-left:10px">
      Font(px):
      <input id="fontSel" type="number" min="12" max="72" value="36" style="width:64px">
    </label>
  </header>

  <main>
    <div id="avatars"></div>
    <div id="now" class="bubble is-fading"></div>
    <div id="timeline"></div>
  </main>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/app.js"></script>
  <script src="/latest.js"></script>
  <script src="/timeline.js"></script>
  <script>
    // ビュー切替
    const viewSel = document.getElementById('viewSel');
    const fontSel = document.getElementById('fontSel');
    (function initUI() {
      const qs = new URLSearchParams(location.search);
      const cur = (qs.get('view') || 'both').toLowerCase();
      viewSel.value = cur;
      apply(cur);
    })();
    function apply(mode) {
      const showAv = mode === 'avatars' || mode === 'both';
      const showLt = mode === 'latest' || mode === 'both';
      const showTl = mode === 'timeline';
      document.getElementById('avatars').classList.toggle('hidden', !showAv);
      document.getElementById('now').classList.toggle('hidden', !showLt);
      document.getElementById('timeline').classList.toggle('hidden', !showTl);
    }
    viewSel.onchange = () => {
      const mode = viewSel.value;
      apply(mode);
      const u = new URL(location.href);
      u.searchParams.set('view', mode);
      u.searchParams.set('font', fontSel.value || '36');
      history.replaceState(null, '', u);
    };
    fontSel.onchange = () => {
      const px = Number(fontSel.value || 36);
      const text = document.querySelector('#now .text');
      if (text) text.style.fontSize = `${px}px`;
      const u = new URL(location.href);
      u.searchParams.set('font', String(px));
      history.replaceState(null, '', u);
    };
  </script>
</body>

</html>